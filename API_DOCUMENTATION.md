# API de Publicaciones y Comentarios - Documentaci√≥n

Esta API RESTful permite a los usuarios crear publicaciones tipo blog y comentar en ellas. Incluye autenticaci√≥n JWT, control de permisos, validaciones y protecci√≥n contra XSS.

## üì° Base URL

```
http://localhost:5000
```

## üîê Autenticaci√≥n

La API utiliza JWT (JSON Web Tokens) para la autenticaci√≥n. Para acceder a rutas protegidas, incluye el token en el header `Authorization`:

```
Authorization: Bearer <tu_token_jwt>
```

---

## üìã Endpoints

### üîë Autenticaci√≥n

| M√©todo | Ruta | Descripci√≥n | Protegido | Request Body |
|--------|------|-------------|-----------|--------------|
| `POST` | `/auth/register` | Registro de usuario | ‚ùå | `{ nombre, email, password }` |
| `POST` | `/auth/login` | Inicio de sesi√≥n | ‚ùå | `{ email, password }` |

#### `POST /auth/register`
**Descripci√≥n:** Registra un nuevo usuario en el sistema.

**Request Body:**
```json
{
  "nombre": "string (m√≠n: 2 caracteres)",
  "email": "string (formato email v√°lido)",
  "password": "string (8-20 chars, 1 may√∫scula, 1 n√∫mero, 1 especial)"
}
```

**Response (201):**
```json
{
  "success": true,
  "data": {
    "message": "Usuario registrado correctamente",
    "usuario": {
      "id": "uuid",
      "nombre": "string",
      "email": "string"
    }
  }
}
```

**Errores:**
- `400` - Datos inv√°lidos o faltantes
- `409` - Email ya registrado

---

#### `POST /auth/login`
**Descripci√≥n:** Autentica un usuario y devuelve un token JWT.

**Request Body:**
```json
{
  "email": "string",
  "password": "string"
}
```

**Response (200):**
```json
{
  "success": true,
  "data": {
    "token": "jwt_token_string",
    "usuario": {
      "id": "uuid",
      "nombre": "string",
      "email": "string"
    }
  }
}
```

**Errores:**
- `400` - Datos faltantes
- `401` - Credenciales inv√°lidas

---

### üìù Publicaciones

| M√©todo | Ruta | Descripci√≥n | Protegido | Query Params | Request Body |
|--------|------|-------------|-----------|--------------|--------------|
| `GET` | `/publicaciones` | Listar publicaciones con paginaci√≥n | ‚ùå | `page, limit, searchWord` | - |
| `GET` | `/publicaciones/:id` | Ver publicaci√≥n espec√≠fica | ‚ùå | - | - |
| `POST` | `/publicaciones` | Crear nueva publicaci√≥n | ‚úÖ | - | `{ titulo, contenido }` |
| `PUT` | `/publicaciones/:id` | Editar publicaci√≥n (solo autor) | ‚úÖ | - | `{ titulo, contenido }` |
| `DELETE` | `/publicaciones/:id` | Eliminar publicaci√≥n (solo autor) | ‚úÖ | - | - |

#### `GET /publicaciones`
**Descripci√≥n:** Lista todas las publicaciones con paginaci√≥n y b√∫squeda opcional.

**Query Parameters:**
- `page` (opcional): N√∫mero de p√°gina (default: 1, m√≠n: 1)
- `limit` (opcional): Elementos por p√°gina (default: 10, m√≠n: 1, m√°x: 100)
- `searchWord` (opcional): Palabra clave para buscar en t√≠tulo/contenido

**Ejemplo:**
```
GET /publicaciones?page=1&limit=5&searchWord=API
```

**Response (200):**
```json
{
  "success": true,
  "data": {
    "publicaciones": [
      {
        "id": "uuid",
        "titulo": "string",
        "contenido": "string",
        "fecha_creacion": "datetime",
        "fecha_actualizacion": "datetime",
        "usuario_id": "uuid",
        "nombre_usuario": "string"
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 5,
      "totalItems": 23,
      "itemsPerPage": 5,
      "hasNextPage": true,
      "hasPrevPage": false
    }
  }
}
```

---

#### `GET /publicaciones/:id`
**Descripci√≥n:** Obtiene una publicaci√≥n espec√≠fica por su ID.

**Parameters:**
- `id` (required): UUID de la publicaci√≥n

**Response (200):**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "titulo": "string",
    "contenido": "string",
    "fecha_creacion": "datetime",
    "fecha_actualizacion": "datetime",
    "usuario_id": "uuid",
    "nombre_usuario": "string"
  }
}
```

**Errores:**
- `400` - ID inv√°lido (no es UUID)
- `404` - Publicaci√≥n no encontrada

---

#### `POST /publicaciones`
**Descripci√≥n:** Crea una nueva publicaci√≥n. Requiere autenticaci√≥n.

**Headers:**
```
Authorization: Bearer <token>
Content-Type: application/json
```

**Request Body:**
```json
{
  "titulo": "string (1-100 caracteres)",
  "contenido": "string (1-500 caracteres)"
}
```

**Response (201):**
```json
{
  "success": true,
  "data": {
    "message": "Publicaci√≥n creada",
    "id": "uuid"
  }
}
```

**Errores:**
- `400` - Datos inv√°lidos o faltantes
- `401` - Token inv√°lido o faltante

---

#### `PUT /publicaciones/:id`
**Descripci√≥n:** Edita una publicaci√≥n existente. Solo el autor puede editarla.

**Headers:**
```
Authorization: Bearer <token>
Content-Type: application/json
```

**Parameters:**
- `id` (required): UUID de la publicaci√≥n

**Request Body:**
```json
{
  "titulo": "string (1-100 caracteres)",
  "contenido": "string (1-500 caracteres)"
}
```

**Response (200):**
```json
{
  "success": true,
  "data": {
    "message": "Publicaci√≥n actualizada"
  }
}
```

**Errores:**
- `400` - Datos inv√°lidos o ID inv√°lido
- `401` - Token inv√°lido o faltante
- `403` - No tienes permisos para editar esta publicaci√≥n
- `404` - Publicaci√≥n no encontrada

---

#### `DELETE /publicaciones/:id`
**Descripci√≥n:** Elimina una publicaci√≥n. Solo el autor puede eliminarla.

**Headers:**
```
Authorization: Bearer <token>
```

**Parameters:**
- `id` (required): UUID de la publicaci√≥n

**Response (200):**
```json
{
  "success": true,
  "data": {
    "message": "Publicaci√≥n eliminada"
  }
}
```

**Errores:**
- `400` - ID inv√°lido
- `401` - Token inv√°lido o faltante
- `403` - No tienes permisos para eliminar esta publicaci√≥n
- `404` - Publicaci√≥n no encontrada

---

### üí¨ Comentarios

| M√©todo | Ruta | Descripci√≥n | Protegido | Request Body |
|--------|------|-------------|-----------|--------------|
| `GET` | `/publicaciones/:id/comentarios` | Ver comentarios de una publicaci√≥n | ‚ùå | - |
| `POST` | `/publicaciones/:id/comentarios` | Crear comentario en una publicaci√≥n | ‚úÖ | `{ contenido }` |

#### `GET /publicaciones/:id/comentarios`
**Descripci√≥n:** Lista todos los comentarios de una publicaci√≥n espec√≠fica.

**Parameters:**
- `id` (required): UUID de la publicaci√≥n

**Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "contenido": "string",
      "fecha_creacion": "datetime",
      "usuario_id": "uuid",
      "publicacion_id": "uuid",
      "nombre_usuario": "string"
    }
  ]
}
```

**Errores:**
- `400` - ID de publicaci√≥n inv√°lido
- `404` - Publicaci√≥n no encontrada

---

#### `POST /publicaciones/:id/comentarios`
**Descripci√≥n:** Crea un nuevo comentario en una publicaci√≥n. Requiere autenticaci√≥n.

**Headers:**
```
Authorization: Bearer <token>
Content-Type: application/json
```

**Parameters:**
- `id` (required): UUID de la publicaci√≥n

**Request Body:**
```json
{
  "contenido": "string (1-200 caracteres)"
}
```

**Response (201):**
```json
{
  "success": true,
  "data": {
    "message": "Comentario creado",
    "id": "uuid"
  }
}
```

**Errores:**
- `400` - Datos inv√°lidos, contenido vac√≠o o ID inv√°lido
- `401` - Token inv√°lido o faltante
- `404` - Publicaci√≥n no encontrada

---

## üõ°Ô∏è Seguridad

### Sanitizaci√≥n de HTML
- Todo el contenido de publicaciones y comentarios es sanitizado autom√°ticamente para prevenir ataques XSS
- Se eliminan scripts y etiquetas HTML peligrosas

### Validaciones
- **Passwords:** M√≠nimo 8 caracteres, m√°ximo 20, debe incluir may√∫scula, n√∫mero y car√°cter especial
- **Emails:** Formato v√°lido requerido
- **UUIDs:** Validaci√≥n estricta de formato
- **Contenido:** L√≠mites de longitud aplicados

### Autenticaci√≥n
- JWT con expiraci√≥n configurable
- Middleware de verificaci√≥n en rutas protegidas
- Control de permisos por autor en publicaciones

---

## üìä C√≥digos de Estado HTTP

| C√≥digo | Descripci√≥n |
|--------|-------------|
| `200` | OK - Operaci√≥n exitosa |
| `201` | Created - Recurso creado exitosamente |
| `400` | Bad Request - Datos inv√°lidos o faltantes |
| `401` | Unauthorized - Token inv√°lido o faltante |
| `403` | Forbidden - Sin permisos para la operaci√≥n |
| `404` | Not Found - Recurso no encontrado |
| `409` | Conflict - Recurso ya existe (email duplicado) |
| `500` | Internal Server Error - Error del servidor |

---

## üß™ Ejemplos de Uso

### 1. Registro y Login
```bash
# Registro
curl -X POST http://localhost:5000/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "nombre": "Juan P√©rez",
    "email": "juan@example.com",
    "password": "MiPassword123@"
  }'

# Login
curl -X POST http://localhost:5000/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "juan@example.com",
    "password": "MiPassword123@"
  }'
```

### 2. Crear Publicaci√≥n
```bash
curl -X POST http://localhost:5000/publicaciones \
  -H "Authorization: Bearer <tu_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "titulo": "Mi primera publicaci√≥n",
    "contenido": "Contenido de la publicaci√≥n..."
  }'
```

### 3. Listar Publicaciones con B√∫squeda
```bash
curl "http://localhost:5000/publicaciones?page=1&limit=5&searchWord=API"
```

### 4. Crear Comentario
```bash
curl -X POST http://localhost:5000/publicaciones/{id}/comentarios \
  -H "Authorization: Bearer <tu_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "contenido": "Este es mi comentario..."
  }'
```

---

## üîß Configuraci√≥n

### Variables de Entorno Requeridas
```env
DB_HOST=localhost
DB_USER=usuario
DB_PASSWORD=password
DB_NAME=nombre_base_datos
JWT_SECRET=tu_jwt_secret_muy_seguro
JWT_EXPIRES_IN=24h
PORT=5000
```

---

## üìÅ Estructura del Proyecto

```
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ connection.js
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comentarios.controller.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ publicaciones.controller.js
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth_middleware.js
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.model.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comentarios.model.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ publicacion.model.js
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comentarios.routes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ publicaciones.routes.js
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.schema.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comentarios.schema.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ paginacion.schema.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ publicaciones.schema.js
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ responseHandler.js
‚îÇ       ‚îî‚îÄ‚îÄ sanitizarHtml.js
‚îú‚îÄ‚îÄ test/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ server.js
```

---

## üìû Soporte

Para reportar bugs o solicitar nuevas funcionalidades, crea un issue en el repositorio del proyecto.
